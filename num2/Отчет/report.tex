%%  A report on laboratory work 2.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[12pt,a4paper]{article}

%%  Стандартные языковые команды
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
%\usepackage[T2A]{fontenc}   %  это устанавливается авторматически

%%  Подключение стилевого файла отчета
\usepackage{kprj}

%%   Подключение пакета управления гиперссылками (только для pdftex)
\ifpdftex
   \BlackColorLinks
\fi

%%  Для подключения рисунков (разные форматы при разном компилировании)
\ifpdftex
  % pdftex понимает форматы рисунков PNG, JPEG, PDF
  \DeclareGraphicsExtensions{.pdf}
\else
  % При создании DVI возможны практически все форматы, но EPS предпочтительнее
  \DeclareGraphicsExtensions{.eps}
\fi


%%%    Тип работы
\LabWork                      %   тип документа -- лабораторная работа
\LabWorkNo{2}                 %   номер лабораторной работы
%\variant{5}                   %   вариант лабораторной
%\KursWork
%\KursProject
%\NIR
%\VKR
%\NKR


%%%  Данные для оформления

\author{С.С.~Погосян}                     %   автор
%\authorfull{Курош Владимир Витальевич}  %   автор -- Фамилия, Имя, Отчество
\workyear{2021}                         %   год выполнения работы
\title{}   %  название
\discipline{Информационный поиск и извлечение информации из текстов}              %  учебная дисциплина
\group{ИУ9-21М}                          %   группа
\faculty{Информатика и системы управления}         %   Факультет
%\facultyshort{ФН}                       %   Факультет -- аббревиатура
%\chair{}    %   кафедра
%\chairno{ФН-12}                         %   кафедра -- аббревиатура
%\chairhead{А.П.~Крищенко}               %   зав. кафедрой
\chief{Н.В.~Лукашевич}                     %   Руководитель работы
%\consultant{А.Ф.~Сидоров}               %   Консультант (если нужно)
%\inspector{Б.О.~Волков}                 %   Нормоконтролер
%\trend{учебная}                         %   Направление работы (указывается в задании)
%\themesource{кафедра}                   %   Источник темы (указывается в задании)

\equationnumbering{section}             %   если нумерация формул в пределах раздела (иначе единая нумерация)
%\figurenumbering{section}              %   (аналогично для рисунков)
%%%   Оформление содержания, в текст вставлять командой \tableofcontents
%\SkipContentsbreak                     %   Подавление разрыва страницы после содержания
%\setcontentsname{Оглавление}           %   Заголовок содержания
%\def\contsectionfont{\bfseries}        %   шрифт для разделов в содержании
%\def\contsubsectionfont{\sf}           %   шрифт для подразделов в содержании
%\setcounter{secnumdepth}{1}            %   глубина заголовков в содержании


\usepackage{hyperref}

\begin{document}	
\maketitle
%\tableofcontents
\newpage
\section{Постановка задачи}
\begin{figure}[h!]
\includegraphics[scale=0.5]{1.png}
\caption{Условие задачи}
\end{figure}
Дан запрос Car insurance\\
Необходимо вычислить вес каждого документа 
\begin{enumerate}
\item Представить запрос как вектор
\item Представить документ как вектор
\item Вычислить сходство запроса и документа
\begin{itemize}
\item Tf – 1) число вхождений и 2) log от числа 
вхождений
\item Idf –
\item  Вектор документа нормализуется, вектор запроса 
без idf, т.е. просто вектор числа вхождений
\end{itemize}
\item Показать, какие веса у документов по отношению к 
запросу и как упорядочатся документы
\end{enumerate}

\section{Реализация}
Имеем пространство состояний (набор слов) V следующего вида:
$$V = (\text{car}, \text{auto}, \text{insurance}, \text{best})$$
В $|V|$ векторы документов будут иметь следующий вид:
$$d_1 = (27, 3, 0, 14),$$
$$d_2 = (4, 33, 33, 0),$$
$$d_3 = (24, 0, 29, 17),$$
\noindent где компоненты векторов это частоты термов в соответствующих документах в пространстве состояний. Вектор запроса имеет вид:
$$ Q = (1,0,1,0).$$
\newpage
Зная idf для каждого слова в запросе можно вычислить tf-idf веса для документов по формуле 
$$W_{t,d} = tf \cdot idf.$$
$$W_{t_1,d_1} = 27 \cdot 1.65 = 44.55,$$
$$W_{t_2, d_1} = 3 \cdot 2.08 = 6.24,$$
$$W_{t_3, d_1} = 0 \cdot 1.62 = 0,$$
$$W_{t_4, d_1} = 14 \cdot 1.5 = 21,$$
\noindent и т.д. В итоге получим матрицу весов документа в пространстве состояний следующего вида:
$$
W = \begin{pmatrix}
44.55 & 6.6 & 39.6\\
6.24 &68.64& 0\\
0& 53.46 &46.98\\
21& 0 &25.5\\
\end{pmatrix}.
$$
По условию задачи td-idf веса для запроса находить не нужно (и бессмысленно для данной задачи).
Далее нормализуем векторы весов документов для вычисления сходства запроса и документа. 
$$
d_{i_k}^n = \dfrac{d_{i_k}}{||d_i||},
$$
\noindent где $d_{i_k}^n$ нормализованные компоненты взвешенных векторов документов.
$$
d_1 = (0.897369, 0.125692, 0, 0.423002),
$$
$$
d_2 = (0.0756426, 0.786683, 0.612705, 0),
$$
$$
d_3 = (0.595268, 0, 0.706204, 0.383317).
$$
Нормализуем вектор запроса:
$$
Q = (\dfrac{1}{\sqrt{2}}, 0, \dfrac{1}{\sqrt{2}},0).
$$
Поскольку векторы $d_i$ и $q$ нормализованы, то косинусная мера будет вычислена по формуле:
$$
\cos (\vec{q}, \vec{d}) = \sum_i q_i d_i,
$$
$$
\cos (\vec{q}, \vec{d_1}) = 0.634536,
$$
$$
\cos (\vec{q}, \vec{d_2}) = 0.486735,
$$
$$
\cos (\vec{q}, \vec{d_3}) = 0.920280.
$$
Далее используем модифицированную формулу для вычисления весов документа:
$$
W_{t,d} = \log(1 + tf)\cdot idf.
$$
$$
W=
\begin{pmatrix}
2.3878 &  1.1533 & 2.3066 \\
1.2523 & 3.1855 &  0 \\
0      & 2.4810 & 2.3929\\
1.7641 & 0      & 1.8829\\
\end{pmatrix}.
$$
Нормализуем взвешенные векторы документов: 
$$
d_1 = (0.741071, 0.38866, 0, 0.547501),
$$
$$
d_2 = (0.274651, 0.758606, 0.590834, 0),
$$
$$
d_3 = (0.603837, 0, 0.626429, 0.492918). 
$$

Тогда косинусные меры будут иметь вид:
$$
\cos (\vec{q}, \vec{d_1}) = 0.524016,
$$
$$
\cos (\vec{q}, \vec{d_2}) = 0.611990,
$$
$$
\cos (\vec{q}, \vec{d_3}) = 0.869929.
$$
Видно, что в первом случае документы упорядочатся следующим образом:
$$
(d_3, d_1, d_2),
$$
\noindent а во втором
$$
(d_3, d_2, d_1),
$$
\noindent где $d_3$ самый релевантный документ (далее по убыванию весов).
\end{document}